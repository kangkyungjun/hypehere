{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "í”„ë¡œí•„ ìˆ˜ì • - HypeHere" %}{% endblock %}

{% block content %}
<div class="container" style="max-width: 480px; margin: 0 auto; padding: var(--space-lg);">
    <!-- Profile Update Form Card -->
    <div class="card">
        <div class="card-body">
            <!-- Error Alert (Hidden by default) -->
            <div id="error-alert" class="alert alert-error hidden" style="margin-bottom: var(--space-md);">
                <span id="error-message"></span>
            </div>

            <!-- Success Alert (Hidden by default) -->
            <div id="success-alert" class="alert alert-success hidden" style="margin-bottom: var(--space-md);">
                <span id="success-message">{% trans "í”„ë¡œí•„ ìˆ˜ì • ì„±ê³µ!" %}</span>
            </div>

            <form id="profile-update-form" method="post" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Email (Read-only) -->
                <div class="form-group">
                    <label for="email" class="form-label">{% trans "ì´ë©”ì¼ (ë¡œê·¸ì¸ ID)" %}</label>
                    <input
                        type="email"
                        id="email"
                        name="email"
                        class="form-control"
                        value="{{ user.email }}"
                        readonly
                        disabled
                        style="background-color: var(--color-bg-secondary); cursor: not-allowed;"
                    >
                    <span class="form-text">{% trans "ì´ë©”ì¼ì€ ë³´ì•ˆìƒ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." %}</span>
                </div>

                <!-- Nickname (Display Name) -->
                <div class="form-group">
                    <label for="nickname" class="form-label">{% trans "ë‹‰ë„¤ì„ (í‘œì‹œ ì´ë¦„) *" %}</label>
                    <input
                        type="text"
                        id="nickname"
                        name="nickname"
                        class="form-control"
                        placeholder="{% trans "í™ê¸¸ë™" %}"
                        value="{{ user.nickname }}"
                        required
                        maxlength="50"
                    >
                    <span class="form-text">{% trans "ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ í‘œì‹œë  ì´ë¦„ì…ë‹ˆë‹¤." %}</span>
                    <span class="form-error" id="nickname-error"></span>
                </div>

                <!-- Date of Birth -->
                <div class="form-group">
                    <label for="date_of_birth" class="form-label">{% trans "ìƒë…„ì›”ì¼" %}</label>
                    <input
                        type="date"
                        id="date_of_birth"
                        name="date_of_birth"
                        class="form-control"
                        value="{{ user.date_of_birth|date:'Y-m-d' }}"
                    >
                    <span class="form-error" id="date_of_birth-error"></span>
                </div>

                <!-- Bio -->
                <div class="form-group">
                    <label for="bio" class="form-label">{% trans "ìê¸°ì†Œê°œ" %}</label>
                    <textarea
                        id="bio"
                        name="bio"
                        class="form-control"
                        rows="4"
                        maxlength="200"
                        placeholder="{% trans "ìì‹ ì„ ì†Œê°œí•´ì£¼ì„¸ìš”..." %}"
                    >{{ user.bio }}</textarea>
                    <span class="form-text" id="bio-counter">0 / 200{% trans "ì" %}</span>
                    <span class="form-error" id="bio-error"></span>
                </div>

                <!-- Country -->
                <div class="form-group">
                    <label for="country" class="form-label">{% trans "êµ­ê°€" %}</label>
                    <div class="country-selector" id="country-selector"></div>
                    <input type="hidden" id="country" name="country" value="{{ user.country }}">
                    <span class="form-error" id="country-error"></span>
                </div>

                <!-- City -->
                <div class="form-group">
                    <label for="city" class="form-label">{% trans "ë„ì‹œ" %}</label>
                    <input
                        type="text"
                        id="city"
                        name="city"
                        class="form-control"
                        placeholder="{% trans "ì„œìš¸" %}"
                        value="{{ user.city }}"
                        maxlength="100"
                    >
                    <span class="form-error" id="city-error"></span>
                </div>

                <!-- Action Buttons -->
                <div style="display: flex; gap: var(--space-sm); margin-top: var(--space-lg);">
                    <button type="submit" class="btn btn-primary" id="submit-btn" style="flex: 1;">
                        <span id="submit-text">{% trans "ì €ì¥í•˜ê¸°" %}</span>
                        <span id="submit-loading" class="spinner spinner-primary" class="hidden"></span>
                    </button>
                    <a href="{% url 'accounts:profile' %}" class="btn btn-secondary" style="flex: 1; text-align: center; text-decoration: none;">
                        {% trans "ì·¨ì†Œ" %}
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- JavaScript for AJAX Profile Update -->
<script>
    // i18n for auth.js
    window.AUTH_I18N = {
        charCounter: "{% trans "ì" %}",
        errorImageOnly: "{% trans "ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤." %}",
        errorFileSize: "{% trans "íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤." %}",
        errorNicknameRequired: "{% trans "ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." %}",
        errorCheckInput: "{% trans "ì…ë ¥ ì •ë³´ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”." %}",
        errorNicknameLength: "{% trans "ë‹‰ë„¤ì„ì€ ìµœëŒ€ 50ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤." %}",
        errorBioLength: "{% trans "ìê¸°ì†Œê°œëŠ” ìµœëŒ€ 200ìê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤." %}",
        successUpdate: "{% trans "í”„ë¡œí•„ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!" %}",
        errorUpdateFailed: "{% trans "í”„ë¡œí•„ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤." %}",
        errorNetwork: "{% trans "ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”." %}",
        placeholderSelect: "{% trans "ì„ íƒí•˜ì„¸ìš”" %}",
        placeholderSearchCountry: "{% trans "ğŸ” êµ­ê°€ ê²€ìƒ‰..." %}",
        emptySearchResult: "{% trans "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤" %}"
    };
</script>
<script src="{% static 'js/countries.js' %}"></script>
<script src="{% static 'js/country-selector.js' %}"></script>
<script src="{% static 'js/auth.js' %}"></script>
<script>
// Initialize country selector
document.addEventListener('DOMContentLoaded', function() {
    const currentCountry = '{{ user.country }}' || '';

    const countrySelector = new CountrySelector('country-selector', {
        countries: COUNTRIES,
        placeholder: window.AUTH_I18N.placeholderSelect,
        searchPlaceholder: window.AUTH_I18N.placeholderSearchCountry,
        emptyText: window.AUTH_I18N.emptySearchResult,
        initialValue: currentCountry,
        onChange: function(country) {
            // Value is automatically updated in hidden input
            console.log('Selected country:', country);
        }
    });
});
</script>
{% endblock %}
