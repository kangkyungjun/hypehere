{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "1:1 ëœë¤ ì±„íŒ… - HypeHere" %}{% endblock %}

{% block content %}
<div class="matching-container">
    <!-- Matching Preferences Screen -->
    <div class="matching-screen" id="preferences-screen">
        <div class="matching-card">
            <div class="matching-header">
                <div class="matching-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </div>
                <h1>{% trans "1:1 ìµëª… ëœë¤ ë§¤ì¹­" %}</h1>
                <p class="subtitle">{% trans "ì „ ì„¸ê³„ ì‚¬ëŒë“¤ê³¼ ì‹¤ì‹œê°„ ì˜ìƒ/ì±„íŒ…ì„ ë‚˜ëˆ ë³´ì„¸ìš”" %}</p>

                <!-- ì•ˆë‚´ ë©”ì‹œì§€ -->
                <div class="info-box" style="margin-top: var(--space-lg); padding: var(--space-md); background: rgba(102, 126, 234, 0.1); border-radius: 8px; border-left: 4px solid var(--color-primary);">
                    <div style="display: flex; gap: var(--space-sm); align-items: start;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="12" y1="16" x2="12" y2="12"/>
                            <line x1="12" y1="8" x2="12.01" y2="8"/>
                        </svg>
                        <p style="margin: 0; font-size: 0.875rem; color: var(--color-text-light); line-height: 1.5;">
                            {% trans "ì›í•˜ëŠ” ì±„íŒ… ëª¨ë“œë¥¼ ì„ íƒí•˜ë©´ ê°™ì€ ëª¨ë“œë¥¼ ì„ íƒí•œ ì‚¬ëŒê³¼ ë§¤ì¹­ë©ë‹ˆë‹¤." %}
                        </p>
                    </div>
                </div>
            </div>

            <form id="matching-form" class="matching-form">
                <div class="form-group">
                    <label for="preferred-gender">{% trans "ì„±ë³„" %}</label>
                    <button type="button" id="gender-selector-btn" class="form-select-btn"
                            data-label-all="{% trans 'ì „ì²´' %}"
                            data-label-male="{% trans 'ë‚¨ì„±' %}"
                            data-label-female="{% trans 'ì—¬ì„±' %}"
                            data-label-other="{% trans 'ê¸°íƒ€' %}">
                        <span id="selected-gender-text">{% trans "ì „ì²´" %}</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 11L3 6h10l-5 5z"/>
                        </svg>
                    </button>
                    <input type="hidden" id="preferred-gender" name="preferred_gender" value="any">
                </div>

                <div class="form-group">
                    <label for="preferred-country-selector">{% trans "êµ­ê°€" %}</label>
                    <div id="preferred-country-selector"></div>
                </div>

                <div class="form-group">
                    <label>{% trans "ì±„íŒ… ëª¨ë“œ" %}</label>
                    <div class="chat-mode-selector">
                        <label class="mode-option">
                            <input type="radio" name="chat_mode" value="text" checked>
                            <span class="mode-icon">ğŸ’¬</span>
                            <span class="mode-label">{% trans "ê¸€ ì±„íŒ…" %}</span>
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="chat_mode" value="video">
                            <span class="mode-icon">ğŸ“¹</span>
                            <span class="mode-label">{% trans "ì˜ìƒ ì±„íŒ…" %}</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-large">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                    {% trans "ë§¤ì¹­ ì‹œì‘" %}
                </button>
            </form>
        </div>
    </div>

    <!-- Waiting/Searching Screen -->
    <div class="matching-screen hidden" id="waiting-screen">
        <div class="matching-card">
            <div class="matching-header">
                <div class="loading-animation">
                    <div class="spinner"></div>
                </div>
                <h1>{% trans "ë§¤ì¹­ ì¤‘..." %}</h1>
                <p class="subtitle">{% trans "ëŒ€í™” ìƒëŒ€ë¥¼ ì°¾ê³  ìˆìŠµë‹ˆë‹¤" %}</p>
            </div>

            <div class="queue-info">
                <div class="queue-position">
                    <span class="label">{% trans "ëŒ€ê¸°ì—´ ìˆœì„œ" %}</span>
                    <span class="value" id="queue-position">-</span>
                </div>
                <div class="queue-size">
                    <span class="label">{% trans "ëŒ€ê¸° ì¸ì›" %}</span>
                    <span class="value" id="queue-size">-</span>
                </div>
            </div>

            <button type="button" id="cancel-matching-btn" class="btn btn-secondary btn-large">
                {% trans "ë§¤ì¹­ ì·¨ì†Œ" %}
            </button>
        </div>
    </div>

    <!-- Anonymous Chat Screen -->
    <div class="matching-screen hidden" id="chat-screen">
        <div class="chat-container">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-info">
                    <span class="chat-title">{% trans "ìµëª… ì‚¬ìš©ì" %}</span>
                    <span class="chat-status" id="chat-status">{% trans "ì—°ê²°ë¨" %}</span>
                </div>
                <div class="chat-actions">
                    <button type="button" id="follow-btn" class="btn-icon" title="{% trans 'ëŒ€í™” ìƒëŒ€ì™€ ì—°ê²°' %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="8.5" cy="7" r="4"/>
                            <line x1="20" y1="8" x2="20" y2="14"/>
                            <line x1="23" y1="11" x2="17" y2="11"/>
                        </svg>
                    </button>
                    <button type="button" id="report-btn" class="btn-icon" title="{% trans 'ì‹ ê³ ' %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/>
                            <line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                    </button>
                    <button type="button" id="block-btn" class="btn-icon" title="{% trans 'ì°¨ë‹¨' %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/>
                        </svg>
                    </button>
                    <button type="button" id="leave-chat-btn" class="btn-icon btn-danger" title="{% trans 'ë‚˜ê°€ê¸°' %}">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                            <polyline points="16 17 21 12 16 7"/>
                            <line x1="21" y1="12" x2="9" y2="12"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Video Container (hidden by default) -->
            <div id="video-container" class="video-container hidden">
                <!-- Remote Video (ìƒëŒ€ë°© - ìƒë‹¨ 50%) -->
                <div class="remote-video-wrapper">
                    <video id="remote-video" autoplay playsinline></video>
                    <div class="video-controls">
                        <button type="button" id="camera-toggle" class="video-control-btn" title="{% trans 'ì¹´ë©”ë¼ ë„ê¸°/ì¼œê¸°' %}">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="23 7 16 12 23 17 23 7"/>
                                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
                            </svg>
                        </button>
                        <button type="button" id="mic-toggle" class="video-control-btn" title="{% trans 'ë§ˆì´í¬ ë„ê¸°/ì¼œê¸°' %}">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                <line x1="12" y1="19" x2="12" y2="23"/>
                                <line x1="8" y1="23" x2="16" y2="23"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <!-- Local Video (ë‚´ ì˜ìƒ - í•˜ë‹¨ 50%) -->
                <div class="local-video-wrapper">
                    <video id="local-video" autoplay playsinline muted></video>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="chat-messages" id="chat-messages">
                <div class="system-message">
                    {% trans "ìµëª… ì±„íŒ…ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ëŒ€í™” ë‚´ìš©ì€ ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤." %}
                </div>
            </div>

            <!-- Chat Input -->
            <form class="chat-input-form" id="chat-input-form">
                <input
                    type="text"
                    id="chat-input"
                    placeholder="{% trans 'ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...' %}"
                    autocomplete="off"
                    maxlength="500"
                />
                <button type="submit" class="btn-send">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="22" y1="2" x2="11" y2="13"/>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
                    </svg>
                </button>
            </form>
        </div>
    </div>
</div>

<!-- Leave Confirmation Modal -->
<div class="modal hidden" id="leave-modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <h3>{% trans "ëŒ€í™”ë°© ë‚˜ê°€ê¸°" %}</h3>
        <p>{% trans "ë°©ì„ ë‚˜ê°€ë©´ ëŒ€í™” ìƒëŒ€ì™€ ì—°ê²°ì´ ëŠì–´ì§‘ë‹ˆë‹¤." %}</p>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="cancel-leave-btn">{% trans "ì·¨ì†Œ" %}</button>
            <button type="button" class="btn btn-danger" id="confirm-leave-btn">{% trans "ë‚˜ê°€ê¸°" %}</button>
        </div>
    </div>
</div>

<!-- Report Modal -->
<div class="modal hidden" id="report-modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <h3>{% trans "ì‚¬ìš©ì ì‹ ê³ " %}</h3>
        <form id="report-form">
            <div class="form-group">
                <label for="report-type">{% trans "ì‹ ê³  ìœ í˜•" %}</label>
                <select id="report-type" name="report_type" class="form-select" required>
                    <option value="">{% trans "ì„ íƒí•˜ì„¸ìš”" %}</option>
                    <option value="abuse">{% trans "ìš•ì„¤/ë¹„ë°©" %}</option>
                    <option value="spam">{% trans "ìŠ¤íŒ¸/ê´‘ê³ " %}</option>
                    <option value="inappropriate">{% trans "ë¶€ì ì ˆí•œ ë‚´ìš©" %}</option>
                    <option value="harassment">{% trans "ì„±í¬ë¡±" %}</option>
                    <option value="other">{% trans "ê¸°íƒ€" %}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="report-description">{% trans "ìƒì„¸ ì„¤ëª… (ì„ íƒ)" %}</label>
                <textarea id="report-description" name="description" rows="4" class="form-textarea"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancel-report-btn">{% trans "ì·¨ì†Œ" %}</button>
                <button type="submit" class="btn btn-primary">{% trans "ì‹ ê³ í•˜ê¸°" %}</button>
            </div>
        </form>
    </div>
</div>

<!-- Connection Request Modal -->
<div class="modal hidden" id="connection-request-modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <h3>{% trans "ì—°ê²° ìš”ì²­" %}</h3>
        <p>{% trans "ìƒëŒ€ë°©ì´ ë‚˜ë¥¼ íŒ”ë¡œìš°í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ë™ì˜í•˜ì‹­ë‹ˆê¹Œ?" %}</p>
        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" id="reject-connection-btn">{% trans "ì•„ë‹ˆì˜¤" %}</button>
            <button type="button" class="btn btn-primary" id="accept-connection-btn">{% trans "ì˜ˆ" %}</button>
        </div>
    </div>
</div>

<!-- Gender Selection Modal -->
<div class="modal hidden" id="gender-modal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <!-- Header with close button -->
        <div class="gender-modal-header">
            <h3 class="gender-modal-title">{% trans "ì„±ë³„ ì„ íƒ" %}</h3>
            <button type="button" class="gender-modal-close" aria-label="{% trans 'ë‹«ê¸°' %}">âœ•</button>
        </div>
        <!-- Gender options list -->
        <div class="gender-options">
            <button type="button" class="gender-option active" data-value="any">{% trans "ì „ì²´" %}</button>
            <button type="button" class="gender-option" data-value="male">{% trans "ë‚¨ì„±" %}</button>
            <button type="button" class="gender-option" data-value="female">{% trans "ì—¬ì„±" %}</button>
            <button type="button" class="gender-option" data-value="other">{% trans "ê¸°íƒ€" %}</button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/matching.css' %}">
{% endblock %}

{% block extra_js %}
<script>
    // i18n translations for JavaScript
    window.MATCHING_I18N = {
        countryPlaceholder: "{% trans 'ì „ì²´ êµ­ê°€' %}",
        countrySearchPlaceholder: "{% trans 'êµ­ê°€ ê²€ìƒ‰...' %}",
        countryModalTitle: "{% trans 'êµ­ê°€ ì„ íƒ' %}"
    };
</script>
<script src="{% static 'js/countries.js' %}"></script>
<script src="{% static 'js/country-selector.js' %}"></script>
<script src="{% static 'js/webrtc-client.js' %}"></script>
<script src="{% static 'js/matching.js' %}"></script>
{% endblock %}
